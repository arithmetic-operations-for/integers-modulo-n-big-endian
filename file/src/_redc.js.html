<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/_redc.js | @arithmetic-operations-for/integers-modulo-n-big-endian</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<link rel="stylesheet" href="./inject/css/0-style.css"><script src="./inject/script/0-header.js"></script><meta name="description" content="Modular arithmetic for JavaScript"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="@arithmetic-operations-for/integers-modulo-n-big-endian"><meta property="twitter:description" content="Modular arithmetic for JavaScript"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/arithmetic-operations-for/integers-modulo-n-big-endian"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Montgomery.js~Montgomery.html">Montgomery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_iadd">_iadd</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_isub">_isub</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_montgomery">_montgomery</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_mul">_mul</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-_redc">_redc</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modN">modN</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-modR">modR</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/_redc.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import assert from &apos;assert&apos;;
import {
	_zeros as n_zeros,
	_copy as n_copy,
	_reset as n_reset,
	_cmp_n as n_cmp_n,
	_mul as n_mul,
	_iadd as n_iadd,
	_isub as n_isub,
} from &apos;@arithmetic-operations-for/naturals-big-endian&apos;;

/**
 * Function REDC is
 *
 *  input: Integers R = b^k &gt; N with gcd(R, N) = 1,
 *         Integer M in [0, R &#x2212; 1] such that NM &#x2261; &#x2212;1 mod R,
 *         Integer T in the range [0, RN &#x2212; 1]
 *
 *         All numbers are given in base b (big endian order).
 *  output: Integer S in the range [0, N &#x2212; 1] such that S &#x2261; TR&#x2212;1 mod N
 *
 *  m &#x2190; ((T mod R)M) mod R // Can be implemented by discarding limbs
 *  t &#x2190; (T + mN) / R // Can be implemented with a shift
 *  // /!\ T + mN is potentially RN - 1 + (R-1) N = 2RN - N - 1 so need one
 *  // extra limb for carry ?
 *  if t &#x2265; N then
 *   return t &#x2212; N
 *  else
 *   return t // Can add dummy - zero vector here in case we want to avoid side
 *            // channel attacks
 *  end if
 * end function
 *
 */
export default function _redc(b, k, N, Ni, Nj, M, Mi, Mj, T, Ti, Tj) {
	assert(Nj - Ni === k, &apos;|N| !== k&apos;);
	assert(Mj - Mi === k, &apos;|M| !== k&apos;); // Can allow |M| &lt;= k here.
	assert(Tj - Ti === 2 * k + 1, &apos;|T| !== 2*k+1&apos;);
	assert(T[Ti] === 0, &apos;T[Ti] !== 0&apos;);

	// Reduce T mod R
	const _Ti = Tj - k;
	const _2k = k &lt;&lt; 1; // eslint-disable-line no-bitwise

	const m = n_zeros(_2k);
	const mj = _2k;

	// M = ((T mod R) M) mod R
	n_mul(b, T, _Ti, Tj, M, Mi, Mj, m, 0, mj);
	// Could be even more efficient here
	// if we had a multiplication method that discards higher order
	// bits

	const mi = k; // M = m mod R

	// X = m * N
	const X = n_zeros(_2k); // TODO mutualize allocation with m
	const Xj = _2k;
	n_mul(b, m, mi, mj, N, Ni, Nj, X, 0, Xj);

	// T = T + X = T + mN
	n_iadd(b, T, Ti, Tj, X, 0, Xj);

	// T = T / R
	assert(T[Ti] === 0, &apos;T[Ti] !== 0&apos;);
	n_copy(T, Ti + 1, _Ti, T, _Ti);
	// Assert T[Ti] === 0
	const _Ti_1 = _Ti;
	// T[_Ti_1] = T[Ti];
	n_reset(T, Ti, _Ti_1);

	// If t &#x2265; N then
	if (n_cmp_n(T, _Ti_1, Tj, N, Ni) &gt;= 0) {
		n_isub(b, T, _Ti_1, Tj, N, Ni, Nj); // Return t &#x2212; N
		return true;
	}

	return false;
	// Else return t
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
